@{
    ViewBag.Title = "Refresh";
    Layout = null;
    var interval = ViewBag.interval;
    }

    <!DOCTYPE html>
    <html>
<head>
    <title>Plane Location</title>
    </head>
    <style>
        html {
            height: 100%;
        }

        body {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }

        .map {
            height: 100%;
            width: 100%;
        }

        .marker {
            position: absolute;
            height: 15px;
            width: 15px;
        }

        .app-container {
            height: 100%;
            position: relative;
        }

        .distance {
            position: fixed;
            z-index: 1;
            height: 100%;
            width: 100%;
        }
    </style>
    <body>
        <div class="app-container">
            <img src="~/Images/export-map-share.png" class="map" />
            <img src="~/Images/marker.png" class="marker" />
            <svg class="distance" xmlns="http://www.w3.org/2000/svg" id="way">
            </svg>
        </div>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"
                integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
                crossorigin="anonymous"></script>
        <script>
            function setLocation(value, max, min) {
                return (100 *((value + max) / (max - min)));
        }
            function positionMarker(lon, lat) {
                var latitude = setLocation(lat, 90, -90);
                var longitude = setLocation(lon, 180, -180);
                var xPos = longitude + '%';
                var yPos = latitude + '%';
                var marker = document.querySelector('.marker');
                marker.style.top = yPos;
                marker.style.left = xPos;
                console.log(`longitude: '${lon}' latitude: '${lat}'`);
        }
        function getPosition() {
            $.post('@Url.Action("Position")').done(function (response) {
                var json = JSON.parse(response);
                positionMarker(json.longi, json.lati);
                if (lastPos) {
                    var lastx = (setLocation(lastPos.longi, 180, -180)) * screen.width;
                    var lasty = (setLocation(lastPos.lati,90,-90)) * screen.height;
                    var newx = (setLocation(json.longi,180,-180)) * screen.width;
                    var newy = (setLocation(json.lati,90,-90)) * screen.height;
                    document.querySelector('svg').innerHTML += `<line x1 =  '${lastx}' y1 =  '${lasty}'  x2 =  '${newx}' y2 =  '${newy}' style="stroke:rgb${(255,0,0)};stroke-width:${2}"/>`
                }
                lastPos = json;
            })
            }
            var lastPos;
        setInterval(getPosition,@interval);
        </script>
        @RenderBody()
    </body>
    </html>
